sudo apt update
#sudo apt install apache2 libapache2-mod-proxy-uwsgi redis-server gcc g++ g++-5 python3-dev uwsgi-plugin-python3
sudo apt install apache2 libapache2-mod-proxy-uwsgi gcc g++ g++-5 python3-dev uwsgi-plugin-python3
wget https://bootstrap.pypa.io/get-pip.py
python3 get-pip.py --user

#pip install --user hug pytz numpy h5py redis msgpack-python docutils pillow
pip install --user pytz numpy h5py msgpack-python docutils pillow flask diskcache

git clone https://github.com/reflectometry/reductus
cd reductus
python3 setup.py develop --user


sudo a2enmod headers proxy_balancer lbmethod_byrequests

sudo mkdir /var/www/html/reductus
sudo chown ubuntu:ubuntu /var/www/html/reductus

echo -e '#!/bin/sh\ncp -r reflweb/static/* /var/www/html/reductus\n\necho "copied to web"' > ~/reductus/.git/hooks/post-merge

# copy the config.py from server...
# set up vhosts file...
# set up cron job to start uwsgi servers

# if available memory is low (from running redis), you may need to change this setting
# (e.g. if running on a small cloud instance with 1Gb mem)

# in /etc/sysctl.conf, add the line
vm.overcommit_memory = 1
